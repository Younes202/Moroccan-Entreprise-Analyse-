"use strict";(self.webpackChunkjupyterlab_wakatime=self.webpackChunkjupyterlab_wakatime||[]).push([[838],{838:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var r=n(29),a=n(75),s=n(934),o=n(919),i=n(333),c=n(601);async function l(e="",t={}){const n=c.ServerConnection.makeSettings(),r=i.URLExt.join(n.baseUrl,"jupyterlab-wakatime",e);let a;try{a=await c.ServerConnection.makeRequest(r,t,n)}catch(e){throw new c.ServerConnection.NetworkError(e)}let s=await a.text();if(s.length>0)try{s=JSON.parse(s)}catch(e){console.log("Not a JSON response body.",a)}if(!a.ok)throw new c.ServerConnection.ResponseError(a,s.message||s);return s}let d=Date.now();class u{constructor(e,t=!1){this.statusModel=e,this.debug=t}async beat(e,t){console.log(t,e);const n=Date.now();if("change"===t&&n-d<12e4)return;const r={filepath:e,timestamp:n/1e3,iswrite:"write"===t,debug:this.debug};d=n;const{code:a}=await l("heartbeat",{body:JSON.stringify(r),method:"POST"});this.statusModel.error=a}}var h=n(368),g=n.n(h),m=n(792);const w=new m.LabIcon({name:"jupyterlab-wakatime:wakatime",svgstr:'<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   fill="none"\n   width="16"\n   viewBox="0 0 16 16"\n   version="1.1"\n   id="svg2"\n   height="16"\n   xmlns="http://www.w3.org/2000/svg"\n   xmlns:svg="http://www.w3.org/2000/svg">\n  <defs\n     id="defs2" />\n  <path\n     class="jp-icon2"\n     fill-rule="evenodd"\n     clip-rule="evenodd"\n     d="m 8.0000009,2.70588 c -2.9239077,0 -5.2941209,2.3702131 -5.2941209,5.2941202 0,2.9239078 2.3702132,5.2941198 5.2941209,5.2941198 2.9239081,0 5.2941211,-2.370212 5.2941211,-5.2941198 0,-2.9239071 -2.370213,-5.2941202 -5.2941211,-5.2941202 z"\n     stroke="#000000"\n     stroke-width="1.41176"\n     id="path1" />\n  <path\n     class="jp-icon2"\n     d="m 8.7123427,9.5367426 c -0.050929,0.067129 -0.1273061,0.1103293 -0.2128946,0.1103293 -0.0084,0 -0.016731,-5.494e-4 -0.02499,-0.00142 -0.014154,-0.00171 -0.021886,-0.00289 -0.029541,-0.00461 -0.00949,-0.00223 -0.016555,-0.00423 -0.023505,-0.0067 -0.013375,-0.00468 -0.019341,-0.00706 -0.025131,-0.00964 -0.01359,-0.00662 -0.01839,-0.00906 -0.023155,-0.011793 -0.012955,-0.00787 -0.016341,-0.010201 -0.019694,-0.012559 -0.00558,-0.00395 -0.011155,-0.00805 -0.016479,-0.012455 -0.010445,-0.00868 -0.014121,-0.012069 -0.017755,-0.015533 -0.011045,-0.010982 -0.018105,-0.01885 -0.02481,-0.027066 -0.01267,-0.016017 -0.022975,-0.031647 -0.031871,-0.048348 L 7.9505893,8.9957898 7.6388007,9.4970018 c -0.048921,0.089082 -0.1373646,0.1500701 -0.2389766,0.1500701 -0.1019647,0 -0.1908356,-0.061449 -0.2383062,-0.1525053 L 5.7978937,7.5080352 c -0.044823,-0.054067 -0.072388,-0.1257173 -0.072388,-0.2048115 0,-0.1674353 0.1230705,-0.3032828 0.2748706,-0.3032828 0.098224,0 0.1842355,0.057068 0.2328707,0.1426943 L 7.3842944,8.8435308 7.7082945,8.3159544 c 0.046694,-0.094024 0.1373296,-0.1579066 0.2414117,-0.1579066 0.095224,0 0.1791885,0.053572 0.2284947,0.1348237 L 8.512366,8.8413777 10.318261,6.2558701 c 0.0491,-0.083188 0.133801,-0.1382116 0.230436,-0.1382116 0.1518,0 0.274835,0.1357764 0.274835,0.3032117 0,0.0732 -0.0234,0.140259 -0.06247,0.1926 z"\n     fill="#000000"\n     stroke="#000000"\n     stroke-width="0.352941"\n     id="path2" />\n</svg>\n'});class p extends m.VDomModel{constructor(){super(),this._time="WakaTime",this._error=200}get time(){return this._time}get error(){return this._error}get errorMsg(){switch(this._error){case 0:return"WakaTime is working";case 200:return"WakaTime is initializing";case 127:return"wakatime-cli not found";case 400:return"Plugin error";case 112:return"Rate limited";case 102:return"API or network error";case 104:return"Invalid API key";case 103:return"Config file parse error";case 110:return"Config file read error";case 111:return"Config file write error";default:return"Unknown error"}}set time(e){e&&(this._time=e,this.stateChanged.emit())}set error(e){this._error=e,this.stateChanged.emit()}}class k extends m.VDomRenderer{constructor(e){super(e),this.addClass("jp-wakatime-status")}render(){return g().createElement(o.GroupItem,{spacing:4,title:this.model.errorMsg,"data-error":this.model.error||void 0},g().createElement(w.react,{top:"2px",left:"1px",stylesheet:"statusBar"}),g().createElement(o.TextItem,{source:this.model.time}))}}const b={id:"jupyterlab-wakatime:plugin",description:"A JupyterLab WakaTime extension.",autoStart:!0,requires:[r.INotebookTracker,a.IEditorTracker],optional:[s.ISettingRegistry,o.IStatusBar],activate:(e,t,n,r,a)=>{console.log("JupyterLab extension jupyterlab-wakatime is activated!");const s=new p,o=new u(s);t.widgetAdded.connect(((e,t)=>{var n,r;const a=t.sessionContext.path;null===(n=t.content.model)||void 0===n||n.contentChanged.connect((()=>{o.beat(a,"change")})),null===(r=t.content.model)||void 0===r||r.stateChanged.connect(((e,t)=>{"dirty"===t.name&&t.oldValue&&o.beat(a,"write")}))})),t.currentChanged.connect(((e,t)=>{null!==t&&o.beat(t.sessionContext.path,"switch")})),n.widgetAdded.connect(((e,t)=>{t.context.fileChanged.connect((e=>{o.beat(e.path,"change")})),t.context.saveState.connect(((e,t)=>{"completed"===t&&o.beat(e.path,"write")}))})),n.currentChanged.connect(((e,t)=>{null!==t&&o.beat(t.context.path,"switch")})),r&&r.load(b.id).then((e=>{if(e.get("debug").composite&&(o.debug=!0),e.get("status").composite&&a){const e=new k(s);a.registerStatusItem("wakatime-status",{item:e,align:"right"}),t=s,(n=async()=>{const{time:e}=await l("status");t.time=e})(),setInterval(n,6e4)}var t,n})).catch((e=>{console.error("Failed to load settings for jupyterlab-wakatime.",e)}))}},v=b}}]);